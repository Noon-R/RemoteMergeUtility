# RemoteMergeUtility - 開発状況

## プロジェクト概要

**RemoteMergeUtility**は、厳格なMVVMアーキテクチャを使用したWPFデスクトップアプリケーションで、プロジェクトキーとパスの管理を行います。このアプリケーションは、カスタムURLスキーマの引数を処理し、外部ツール連携を通じてプロジェクト設定に基づいたシェルコマンドを実行するように設計されています。

### 主な目的
- プロジェクトキーとパスのマッピング管理
- カスタムURLスキーマ経由でのパラメータ受信（プロジェクトキー、リビジョン、追加引数）
- 外部ツール連携を通じた解決済みプロジェクトパスでのシェルコマンド実行
- セッション間でのプロジェクト設定維持のための永続データストレージ
- プロジェクトライフサイクル管理のための仮想外部ツールとのシームレス統合

## 現在の開発状況

### 完了した機能

#### 1. **プロジェクトアーキテクチャ & セットアップ**
- .NET 8.0 WPFアプリケーション構造
- 厳格なMVVMパターンの実装
- 包括的なフォルダ構造（Models、ViewModels、Views、Services）
- モダンライブラリ統合と依存関係管理

#### 2. **データ管理システム**
- INotifyPropertyChanged実装を含む`ProjectInfo`モデル
- JSONベースの永続化サービス（`JsonProjectDataService`）
- アプリケーション起動時の自動データ読み込み
- アプリケーション終了時の自動データ保存
- `%AppData%/RemoteMergeUtility/projects.json`へのデータ保存
- コンストラクタ初期化による不変モデル設計
- 適切な逆シリアル化サポートを持つJSONシリアル化

#### 3. **ユーザーインターフェース実装**
- メインプロジェクト管理ウィンドウ
- プロジェクトキー・パスペア用の編集可能DataGrid
- Defaultプロジェクト保護機能付きのプロジェクト追加/削除機能
- リアルタイムセル編集機能
- UpdateSourceTrigger=PropertyChangedでの適切なデータバインディング
- 削除不可Defaultプロジェクトの特別スタイリング

#### 4. **MVVM実装**
- 適切なプロパティ変更通知を持つ`ViewModelBase`
- コマンドバインディング用の`RelayCommand`実装
- 完全なデータ管理を持つ`ProjectManagerViewModel`
- 関心の完全な分離（View、ViewModel、Model）
- コードビハインドのビジネスロジックなし
- readonlyフィールドと定数のUPPER_SNAKE_CASE命名
- 明示的なprivateフィールド宣言（バッキングフィールドなし）
- 専用のprivate readonlyフィールドで実装されたCommandプロパティ

#### 5. **URLスキーマハンドラーシステム**
- カスタムURLスキーマ登録（`mergeutil://`）
- URLパラメータ解析サービス（`UrlSchemeService`）
- App.xaml.csでのコマンドライン引数処理
- レジストリインストール/アンインストールバッチスクリプト
- URL検証とエラーハンドリング
- URLスキーマ検証用テストスイート
- RemoteMergeUtility配下でのレジストリキー整理

#### 6. **外部ツール連携**
- 仮想外部ツールサービスインターフェース（`ILaunchToolService`）
- デバッグビルド用モック実装（`MockLaunchToolService`）
- リリースビルド用実装（`LaunchToolService`）
- プロジェクトライフサイクル管理（起動/ステータス確認）
- 実行中プロジェクトへのHTTPリクエスト送信
- ビルド設定ベースのサービス選択
- パスマッピングからのプロジェクト名解決

#### 7. **アプリケーションインフラストラクチャ**
- 包括的な.gitignoreでのGitリポジトリ初期化
- 適切なプロジェクト構造での初期コミット
- コーディング規約ドキュメント（日本語）
- Claude Code統合ドキュメント
- コードフォーマット標準化（スペースの代わりにタブ）
- 包括的なURLスキーマ登録ドキュメント
- URLスキーマ検証用自動テストスクリプト
- Mutexによる単一インスタンスアプリケーション制御
- バックグラウンド動作のためのシステムトレイ統合
- LogServiceラッパーによる構造化ログシステム
- プロセス間通信用の名前付きパイプサーバー

## 技術スタック

### **コアフレームワーク**
- .NET 8.0（Windows）
- WPF（Windows Presentation Foundation）
- nullable参照型有効化のC#

### **MVVM & ライブラリ**
- **LivetCask (4.0.2)** - メッセージングとMVVMビヘイビア（日本製）
- **CommunityToolkit.Mvvm (8.4.0)** - モダンなMVVMフレームワーク（Microsoft公式）
- **Microsoft.Extensions.DependencyInjection (9.0.7)** - 依存性注入コンテナ
- **MaterialDesignThemes (5.2.1)** - Material DesignUIコンポーネント
- **Serilog.Extensions.Hosting (9.0.0)** - 構造化ログフレームワーク

### **データ & 永続化**
- System.Text.Json - JSONシリアル化（.NET標準）
- アプリケーションデータフォルダでのファイルベース永続化

### **外部統合**
- System.Diagnostics.Process - 外部コマンド実行
- System.Net.Http - REST API通信用HTTPクライアント
- Windowsレジストリ - URLスキーマ登録

## コード品質 & 規約

### **命名規約**
- **クラス、プロパティ、メソッド**: PascalCase
- **privateフィールド**: `_UpperCamelCase`
- **readonlyフィールドと定数**: `_UPPER_SNAKE_CASE`
- **すべてのUI操作**: コマンドバインディング（イベントハンドラーなし）

### **アーキテクチャ準拠**
- Viewにビジネスロジックを含まない
- ViewModelがViewを直接参照しない
- UI更新のためのINotifyPropertyChanged実装Models
- ブロッキングの可能性がある呼び出しの非同期操作
- ユーザーフレンドリーなメッセージでの適切なエラーハンドリング
- テスタビリティとビルド設定切り替えのためのサービス抽象化

## プロジェクト構造

```
RemoteMergeUtility/
├── Documents/					# プロジェクトドキュメント
│   ├── 開発状況.md				# このファイル - プロジェクト進捗概要（日本語）
│   ├── DEVELOPMENT_STATUS.md			# 開発状況（英語版）
│   ├── INSTALLER_GUIDE.md			# Windowsインストーラー作成ガイド
│   └── URL_SCHEME_REGISTRATION.md		# URLスキーマセットアップドキュメント
├── Scripts/					# 自動化スクリプト
│   ├── RegisterUrlScheme.bat			# URLスキーマ登録
│   ├── UnregisterUrlScheme.bat			# URLスキーマ削除
│   └── TestUrlScheme.bat			# URLスキーマテスト
├── Installer/					# Windowsインストーラー設定
│   ├── RemoteMergeUtility.Installer.wixproj	# WiXプロジェクトファイル
│   ├── Product.wxs				# WiXインストーラー定義
│   └── License.rtf				# インストーラー用ライセンス契約
├── BuildInstaller.bat				# 自動インストーラービルドスクリプト
├── RemoteMergeUtility/				# メインソリューションフォルダ
│   ├── RemoteMergeUtility.sln			# Visual Studioソリューション
│   └── RemoteMergeUtility/			# メインプロジェクト
│       ├── Models/				# データモデルとビジネスロジック
│       │   ├── ProjectInfo.cs			# プロジェクトキー・パスモデル
│       │   └── UrlSchemeRequest.cs		# URLスキーマパラメータモデル
│       ├── ViewModels/				# MVVMビューモデル
│       │   ├── ViewModelBase.cs		# ViewModelベースクラス
│       │   ├── RelayCommand.cs			# コマンド実装
│       │   └── ProjectManagerViewModel.cs	# 明示的フィールドを持つメインVM
│       ├── Views/				# XAMLユーザーインターフェース
│       │   └── ProjectManagerView.xaml		# メインプロジェクト管理UI
│       ├── Services/				# 外部サービスとデータアクセス
│       │   ├── IProjectDataService.cs		# データサービスインターフェース
│       │   ├── JsonProjectDataService.cs	# JSON永続化実装
│       │   ├── IUrlSchemeService.cs		# URL解析インターフェース
│       │   ├── UrlSchemeService.cs		# URL解析実装
│       │   ├── ILaunchToolService.cs		# 外部ツールインターフェース
│       │   ├── LaunchToolService.cs		# 実外部ツールサービス
│       │   ├── MockLaunchToolService.cs	# デバッグモックサービス
│       │   └── LogService.cs			# 構造化ログラッパー
│       ├── App.xaml				# トレイサポート付きアプリケーションエントリポイント
│       ├── MainWindow.xaml			# メインアプリケーションウィンドウ
│       └── RemoteMergeUtility.csproj		# プロジェクト設定
├── .gitignore					# .NET用Git無視ルール
├── CLAUDE.md					# Claude Code開発ガイダンス（日本語）
├── wpf_mvvm_coding_standards.md		# 詳細コーディング規約（日本語）
└── README.md					# プロジェクト概要とセットアップ手順
```

## 現在のワークフロー統合

### **URLスキーマ処理フロー**
1. **URL受信**: `mergeutil://?target=ProjectKey&revision=123&args=optional`
2. **単一インスタンスチェック**: Mutexがアプリケーションの単一インスタンスを保証
3. **パラメータ解析**: `UrlSchemeService`がパラメータを抽出・検証
4. **プロジェクト解決**: App.xaml.csがProjectInfoを読み込み、ターゲットパスを解決
5. **外部ツールクエリ**: `ILaunchToolService`が仮想ツール経由でプロジェクトステータスをチェック
6. **条件付き実行**:
   - **実行中でない場合**: 外部ツールコマンド経由でプロジェクトを起動
   - **実行中の場合**: リビジョン/引数データでHTTP POSTリクエストを送信
7. **システムトレイ動作**: 処理後にアプリケーションがバックグラウンドで実行

### **アプリケーションライフサイクル**
- **起動**: 名前付きMutexでの単一インスタンス強制
- **バックグラウンド動作**: コンテキストメニュー付きシステムトレイアイコン
- **プロセス間通信**: URLスキーマ処理用名前付きパイプサーバー
- **グレースフルシャットダウン**: 適切なリソースクリーンアップとデータ永続化

### **ビルド設定による動作**
- **デバッグビルド**: シミュレート応答で`MockLaunchToolService`を使用
- **リリースビルド**: 実際の外部ツール連携で`LaunchToolService`を使用

## 保留中の開発領域

### **次の優先機能**

#### 1. **Windowsインストーラーパッケージ**
- WiX Toolset v3ベースのMSIインストーラー
- インストール時の自動URLスキーマ登録
- スタートメニューショートカットとデスクトップ統合
- レジストリキー削除でのアンインストールクリーンアップ

#### 2. **エラーハンドリング強化**
- Serilog統合での包括的エラーログ
- 再試行メカニズム付きユーザーフレンドリーエラーダイアログ
- アプリケーションクラッシュ復旧と診断

#### 3. **設定管理**
- プロジェクトデータを超えたアプリケーション設定永続化
- 外部ツールエンドポイント設定
- UIテーマと外観オプション
- ログレベルと出力設定

#### 4. **高度なUI機能**
- プロジェクトバリデーション（パス存在チェック）
- プロジェクト設定のインポート/エクスポート機能  
- 検索とフィルタリング機能
- 一般操作のキーボードショートカット

### **将来の拡張**

#### 1. **高度な機能**
- プロジェクトグループ化とカテゴリ化
- 最近のプロジェクト追跡
- バックアップと復元機能
- 多言語サポート拡張

#### 2. **統合機能**
- Gitリポジトリ統合
- Visual Studio統合
- 拡張外部ツール統合機能

#### 3. **ユーザーエクスペリエンス**
- ツールチップとヘルプシステム
- キーボードアクセシビリティ
- パス選択のドラッグアンドドロップサポート

## 開発ノート

### **パフォーマンス考慮事項**
- リアルタイムUI更新のためのObservableCollection使用
- ファイルI/OとHTTP操作のAsync/awaitパターン
- 適切な変更通知による効率的データバインディング
- 適切な廃棄によるサービスライフタイム管理

### **テスト戦略**
- MVVM構造に組み込まれた単体テスト機能
- 依存性注入による簡単なモック化
- サービスインターフェースによるテスト可能アーキテクチャ
- 開発とテスト用のモックサービス

### **デプロイメント準備**
- 自己完結型.NETデプロイメント対応
- レジストリベースURLスキーマ登録
- Windows固有の最適化
- 自動インストールスクリプト

## ビルド & 開発コマンド

```bash
# ソリューションのビルド
dotnet build RemoteMergeUtility/RemoteMergeUtility.sln

# デバッグモードで実行（MockLaunchToolServiceを使用）
dotnet run --project RemoteMergeUtility/RemoteMergeUtility/RemoteMergeUtility.csproj

# リリース用ビルド（LaunchToolServiceを使用）
dotnet build RemoteMergeUtility/RemoteMergeUtility.sln -c Release

# Windowsインストーラーのビルド（WiX Toolset v3.11+が必要）
BuildInstaller.bat

# URLスキーマのテスト（登録後）
Scripts/TestUrlScheme.bat
```

## インストール & セットアップ

```bash
# 1. URLスキーマの登録（管理者として実行）
Scripts/RegisterUrlScheme.bat

# 2. URLスキーマ機能のテスト
Scripts/TestUrlScheme.bat

# 3. 必要に応じてアンインストール（管理者として実行）
Scripts/UnregisterUrlScheme.bat
```

---

**最終更新**: 2025年8月  
**開発段階**: コアアプリケーションインフラストラクチャ完了  
**次のマイルストーン**: Windowsインストーラーパッケージ & エラーハンドリング強化  
**ステータス**: システムトレイ統合とログ機能を含むプロダクション対応コア機能